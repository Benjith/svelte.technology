<iframe ref:child srcdoc='
	<!doctype html>
	<html>
		<head>
			<link href="https://fonts.googleapis.com/css?family=Rajdhani:300,500,700|Roboto:300,300i,500|Roboto+Mono:300" rel="stylesheet">
			<link rel="stylesheet" href="/repl-viewer.css">
		</head>
		<body></body>
	</html>
'></iframe>

<style>
	iframe {
		width: 100%;
		height: 100%;
		border: none;
	}
</style>

<script>
	export default {
		onrender () {
			let component;

			this.refs.child.addEventListener( 'load', () => {
				const iframe = this.refs.child;
				const body = iframe.contentDocument.body;
				const eval2 = iframe.contentWindow.eval;

				this.observe( 'compiled', compiled => {
					if ( !compiled ) return;

					const code = compiled.code.replace( 'export default ', '' ) + '\n\nreturn SvelteComponent;';

					if ( component ) component.teardown();

					eval2( `
						var SvelteComponent = (function () { ${code} }());
						var component = new SvelteComponent({
							target: document.body,
							data: ${this.get( 'json' )}
						});
					`);

					component = iframe.contentWindow.component;
				});

				this.observe( 'json', json => {
					if ( component ) component.set( JSON.parse( json ) );
				});
			});
		}
	};
</script>
