<section class='console'>
	<div class='controls'>
		<button class='{{showConsole ? "" : "active"}}' on:click='set({ showConsole: false })'>data</button>
		<button class='{{showConsole ? "active" : ""}}' on:click='set({ showConsole: true })'>console</button>
	</div>

	{{#if showConsole}}
		TODO console
		<!-- <CodeMirror ref:cm mode='javascript' code='{{compiled.code}}' console/> -->
	{{else}}
		<CodeMirror ref:cm mode='javascript' bind:code='json'/>
	{{/if}}
</section>

<style>

</style>

<script>
	import CodeMirror from './CodeMirror.html';

	export default {
		data: () => ({
			showConsole: false
		}),

		onrender () {
			// TODO we want this to be immediately accessible in the onrender function
			const observer = this.observe( 'data', data => {
				if ( !data ) return;
				observer.cancel();

				const json = JSON.stringify( data, null, '  ' );
				this.set({ json });

				this.observe( 'json', json => {
					let data;

					try {
						data = JSON.parse( json );
					} catch ( err ) {
						// TODO indicate the error
						console.error( err );
					}

					if ( data ) {
						this.set({ data });

						// TODO event should be unnecessary â€“ should be possible with two-way binding, no?
						this.fire( 'data', data );
					}
				});
			});
		},

		methods: {
			resize () {
				this.refs.cm.resize();
			}
		},

		components: {
			CodeMirror
		}
	};
</script>
