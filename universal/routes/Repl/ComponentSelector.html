<div class='module-name'>
	<!-- <div class='dropdown'>
		<select bind:value='selectedComponent'>
			{{#each components as component}}
				<option value='{{component}}'>{{component.name}}.html</option>
			{{/each}}
		</select>

		{{#if selectedComponent.entry}} -->
			<!-- entry module name ('App') is read-only -->
			<!-- <span style='padding-left: 0.2em;'>{{selectedComponent.name}}</span>
		{{else}}
			<div class='input-wrapper'>
				<span class='widther'>{{selectedComponent.name || 'x'}}</span>
				<input tabindex='1' ref:name bind:value='selectedComponent.name' on:focus='this.select()' on:enter='this.blur()'>
			</div>
		{{/if}}

		<span class='file-extension'>.html</span>
	</div> -->

	<!-- <button style='width: 4em;' on:click='remove()' on:mouseout='set({ danger: false })'>
		{{#if danger}}
			sure?
		{{else}}
			delete
		{{/if}}
	</button>

	<button on:click='fire("create")'>add</button> -->
</div>
<div class="panel-header">
	<ul class="file-tabs">
		{{#each components as component}}
		<li class='{{ selectedComponent == component ? "active" : "" }}' data-name='{{component.name}}'>
			<button class='file-tabs-item' on:click='selectComponent(component, selectedComponent)'>
				{{#if component.name == 'App'}}
                    {{component.name}}.html
				{{else}}
					{{#if !component.edit}}
					<div class='editable' title='edit component name' on:click='editTab(selectedComponent)'>
						{{component.name}}.html
					</div>
	                {{else}}
					<div class='file-tabs-item input-wrapper'>
	                    <input ref:name bind:value='component.name' on:focus='this.select()' on:blur='closeEdit(selectedComponent)' on:enter='this.blur()' />
	                </div>
					{{/if}}
	                <!-- <span class='file-extension'>.html</span> -->
	            {{/if}}
			</button>
		</li>
		{{/each}}
		<li>
			
		</li>
	</ul>
	
	<div class="btn-action-container">
		<button class='btn-link' on:click='fire("create")' title="add new component">&#10133;</button>
	</div>
</div>

<style>
	.module-name {
		position: relative;
		display: block;
	}

	button {
		display: block;
		float: right;
		padding: calc(0.5em - 1px);
	}

	.dropdown {
		position: relative;
		display: block;
		float: left;
		padding: 0 2em 0 0;
	}

	.dropdown::after {
		content: 'â–¼';
		position: absolute;
		right: 1rem;
		top: 0.55rem;
		font-size: 0.8em;
		color: #999;
		pointer-events: none;
	}

	select {
		position: absolute;
		width: 100%;
		height: 100%;
		left: 0;
		top: 0;
		opacity: 0;
		font-size: inherit;
	}
	.input-wrapper {
		position: relative;
		display: block;
		float: left;
		line-height: 1;
		margin: 0 0.3em 0 0;
	}

	.widther {
		display: block;
		font-family: inherit;
		font-size: inherit;
		border: 1px solid #eee;
		padding: calc(0.5em - 1px) 0.25em;
		line-height: 1;
	}

	/*input {
		position: absolute;
		width: 100%;
		height: 100%;
		left: 0;
		top: 0;
		font-family: inherit;
		font-size: inherit;
		border: 1px solid rgba(170,30,30,0.3);
		border-radius: 0.2em;
		padding: calc(0.5em - 1px) 0.2em;
		line-height: 1;
		outline: none;
		box-sizing: border-box;
	}

	input:focus {
		border: 1px solid rgb(170,30,30);
	}*/

	.file-extension {
		display: inline-block;
		padding: calc(0.5em - 1px) 0;
		color: #999;
		left: -0.2em;
		pointer-events: none;
	}
	.file-tabs {
		border: none;
		padding-left: 0;
		margin: 0;
		list-style-type: none;
	}
	.file-tabs > li {
		float: left;
		margin-bottom: -1px;
	}
	.file-tabs li.active {
		background-color: #fff;
		border-bottom: 2px solid #31455a;
		font-weight: 500;
	}
	.file-tabs > li > .file-tabs-item {
		float: none;
		border: none;
		border-radius: 0;
		color: #2e3e4e;
		position: relative;
		display: block;
		padding: 10px 15px;
		margin: 0;
	}
	.file-tabs-input {
		padding: 10px 15px;
	}
	.editable {
    	display: inline-block;
    	padding: 0 19px 0 4px;
    	position: relative;
	}
	li.active .editable:hover {
		box-shadow: 0 0 0 1px #ccc;
	    border-radius: 2px;
	    cursor: pointer;
	    visibility: visible;
	}
	.btn-action-container {
		position: absolute;
		right: 0;
		top: 0;
	}
	.btn-link {
		border: none;
		padding: 10px 10px 6px 8px;
    	line-height: 1.45;
	}
	.btn-link:hover {
		border: none;
	}
</style>

<script>
	function keyEvent ( code ) {
		return function ( node, callback ) {
			node.addEventListener( 'keydown', handleKeydown );

			function handleKeydown ( event ) {
				if ( event.keyCode === code ) {
					callback.call( this, event );
				}
			}

			return {
				teardown () {
					node.removeEventListener( 'keydown', handleKeydown );
				}
			};
		}
	}

	export default {
		methods: {
			selectComponent(component, selectedComponent) {
				if (selectedComponent != component) {
					selectedComponent.edit = false;
				}
				this.set({selectedComponent: component})
			},
			editTab(selectedComponent) {
				selectedComponent.edit = true;
				this.set({selectedComponent});
				this.refs.name.focus();
			},
			closeEdit(selectedComponent) {
				selectedComponent.edit = false;
				this.set({selectedComponent});
			},
			remove () {
				if ( this.get( 'danger' ) ) {
					this.fire( 'remove' );
					this.set({ danger: false });
				} else {
					this.set({ danger: true });
				}
			}
		},

		events: {
			enter: keyEvent( 13 )
		}
	};
</script>